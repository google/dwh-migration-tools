name: PR Dependency Scan

on:
  pull_request:
    paths:
      - '**/gradle.lockfile'

jobs:
  osv-scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout PR Branch
        uses: actions/checkout@v4
        with:
          path: pr-branch

      - name: Checkout Main Branch (for suppressions)
        uses: actions/checkout@v4
        with:
          ref: main
          path: main-branch

      - name: Install OSV-Scanner
        run: |
          go install github.com/google/osv-scanner/cmd/osv-scanner@latest

      - name: Scan All Lockfiles
        run: |
          # Finds every lockfile in the PR branch and runs the scanner on each
          find pr-branch -name "gradle.lockfile" -exec ~/go/bin/osv-scanner \
            --lockfile={} \
            --suppressions=main-branch/suppression.xml \;
