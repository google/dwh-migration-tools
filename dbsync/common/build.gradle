/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'dbsync.java-library-conventions'
	alias libs.plugins.protobuf
	alias libs.plugins.jmh
	alias libs.plugins.jmh.report
}

def grpcVersion = '1.63.0'

protobuf {
	plugins {
		grpc {
			artifact = "io.grpc:protoc-gen-grpc-java:$grpcVersion"
		}
	}
	generateProtoTasks {
		all().configureEach {
			plugins {
				grpc {
				}
			}
		}
	}
}

dependencies {
	api libs.slf4j.api
	runtimeOnly libs.logback.classic

	api libs.parquet.generator
	implementation libs.fastutil
	implementation libs.jopt.simple
	implementation libs.jdiagnostics
	api libs.avro
	api "io.grpc:grpc-protobuf:$grpcVersion"
	api "io.grpc:grpc-stub:$grpcVersion"

	testImplementation libs.spring.jdbc
	testImplementation libs.h2
	testImplementation libs.commons.csv
}

jmh {
	resultFormat = 'JSON'
}

jmhReport {
	jmhResultPath = project.file('build/results/jmh/results.json')
	jmhReportOutput = project.file('build/reports/jmh')
}

tasks.named('jmhReport').configure {
	doFirst {
		project.file('build/reports/jmh').mkdirs()
	}
}
