/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    alias libs.plugins.shadow
    id 'com.google.edwmigration.dbsync.java-application-conventions'
}

configurations {
    serverClasspath {
        canBeConsumed = false
    }
}

dependencies {
    implementation project(':common')
    implementation project(':server')
    implementation project(':storage-aws')
    implementation project(':storage-gcs')
    implementation libs.jsch
    implementation libs.jopt.simple
    implementation libs.jdiagnostics
    implementation libs.commons.lang3
    implementation libs.google.cloud.run
    serverClasspath project(path: ':server', configuration: 'shadow')
}

application {
    mainClass = 'com.google.edwmigration.dbsync.client.CloudRunMain'
}

distributions {
    main {
        contents {
            from(configurations.serverClasspath) {
                into 'lib/server'
            }
        }
    }
}

tasks.register('testJar', Jar) {
    manifest {
        attributes 'Description': 'This is an application JAR'
    }
}

tasks.named('shadowJar', com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar) {
    manifest {
        inheritFrom(project.tasks.testJar.manifest)
    }
}